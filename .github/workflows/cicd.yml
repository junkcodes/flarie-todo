name: Flarie App CI CD

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:

#   build-image-bangla-style:
#     name: Build and Push App Image to Registry Bangla Style
#     runs-on: ubuntu-latest
#     steps:
#     - uses: actions/checkout@v3
#     - name: Login to Registry
#       run: echo "${{ secrets.DOCKERPW }}" | docker login -u "junkcodes" --password-stdin
#     - name: Build Image
#       run: docker build -t junkcodes/flarie:bs -f dockerfile/Dockerfile .
#     - name: Push Image
#       run: docker push junkcodes/flarie:bs


#   build-image-geeky-style:
#     name: Build and Push App Image to Registry Geeky Style
#     runs-on: ubuntu-latest
#     steps:
#       - name: Set up QEMU
#         uses: docker/setup-qemu-action@v2
#       - name: Set up Docker Buildx
#         uses: docker/setup-buildx-action@v2
#       - name: Login to Docker Hub
#         uses: docker/login-action@v2
#         with:
#           username: junkcodes
#           password: ${{ secrets.DOCKERPW }}
#       - name: Build and push
#         uses: docker/build-push-action@v4
#         with:
#           file: dockerfile/Dockerfile
#           push: true
#           tags: junkcodes/flarie:gs
          
          
  deploy-via-ssh-bangla-style:
    name: Deploy App to Kubernetes via SSH Bangla Style
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Configuring SSH Client
      run: |
        eval $(ssh-agent -s)
        echo "${{ secrets.SSH_PRIVATE_KEY }}" | base64 -d | tr -d '\r' | ssh-add -
        mkdir -p ~/.ssh
        chmod 700 ~/.ssh
        ssh-keyscan -p 12904 -H 0.tcp.in.ngrok.io >> ~/.ssh/known_hosts
        chmod 644 ~/.ssh/known_hosts
    - name: test
      run: ssh -p 12904 groot@0.tcp.in.ngrok.io "uname -a"
